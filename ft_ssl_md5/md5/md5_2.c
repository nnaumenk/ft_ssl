/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   md5_2.c                                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: nnaumenk <nnaumenk@student.42.fr>          +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2018/08/20 19:34:27 by nnaumenk          #+#    #+#             */
/*   Updated: 2018/11/15 19:44:53 by nnaumenk         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "../../ft_ssl.h"
#include "md5.h"

void		ft_md5_round1(uint32_t *h, uint32_t *p)
{
	h[0] = h[1] + ROL((h[0] + F(h[1], h[2], h[3]) + p[0] + T00), 7);
	h[3] = h[0] + ROL((h[3] + F(h[0], h[1], h[2]) + p[1] + T01), 12);
	h[2] = h[3] + ROL((h[2] + F(h[3], h[0], h[1]) + p[2] + T02), 17);
	h[1] = h[2] + ROL((h[1] + F(h[2], h[3], h[0]) + p[3] + T03), 22);
	h[0] = h[1] + ROL((h[0] + F(h[1], h[2], h[3]) + p[4] + T04), 7);
	h[3] = h[0] + ROL((h[3] + F(h[0], h[1], h[2]) + p[5] + T05), 12);
	h[2] = h[3] + ROL((h[2] + F(h[3], h[0], h[1]) + p[6] + T06), 17);
	h[1] = h[2] + ROL((h[1] + F(h[2], h[3], h[0]) + p[7] + T07), 22);
	h[0] = h[1] + ROL((h[0] + F(h[1], h[2], h[3]) + p[8] + T08), 7);
	h[3] = h[0] + ROL((h[3] + F(h[0], h[1], h[2]) + p[9] + T09), 12);
	h[2] = h[3] + ROL((h[2] + F(h[3], h[0], h[1]) + p[10] + T10), 17);
	h[1] = h[2] + ROL((h[1] + F(h[2], h[3], h[0]) + p[11] + T11), 22);
	h[0] = h[1] + ROL((h[0] + F(h[1], h[2], h[3]) + p[12] + T12), 7);
	h[3] = h[0] + ROL((h[3] + F(h[0], h[1], h[2]) + p[13] + T13), 12);
	h[2] = h[3] + ROL((h[2] + F(h[3], h[0], h[1]) + p[14] + T14), 17);
	h[1] = h[2] + ROL((h[1] + F(h[2], h[3], h[0]) + p[15] + T15), 22);
}

void		ft_md5_round2(uint32_t *h, uint32_t *p)
{
	h[0] = h[1] + ROL((h[0] + G(h[1], h[2], h[3]) + p[1] + T16), 5);
	h[3] = h[0] + ROL((h[3] + G(h[0], h[1], h[2]) + p[6] + T17), 9);
	h[2] = h[3] + ROL((h[2] + G(h[3], h[0], h[1]) + p[11] + T18), 14);
	h[1] = h[2] + ROL((h[1] + G(h[2], h[3], h[0]) + p[0] + T19), 20);
	h[0] = h[1] + ROL((h[0] + G(h[1], h[2], h[3]) + p[5] + T20), 5);
	h[3] = h[0] + ROL((h[3] + G(h[0], h[1], h[2]) + p[10] + T21), 9);
	h[2] = h[3] + ROL((h[2] + G(h[3], h[0], h[1]) + p[15] + T22), 14);
	h[1] = h[2] + ROL((h[1] + G(h[2], h[3], h[0]) + p[4] + T23), 20);
	h[0] = h[1] + ROL((h[0] + G(h[1], h[2], h[3]) + p[9] + T24), 5);
	h[3] = h[0] + ROL((h[3] + G(h[0], h[1], h[2]) + p[14] + T25), 9);
	h[2] = h[3] + ROL((h[2] + G(h[3], h[0], h[1]) + p[3] + T26), 14);
	h[1] = h[2] + ROL((h[1] + G(h[2], h[3], h[0]) + p[8] + T27), 20);
	h[0] = h[1] + ROL((h[0] + G(h[1], h[2], h[3]) + p[13] + T28), 5);
	h[3] = h[0] + ROL((h[3] + G(h[0], h[1], h[2]) + p[2] + T29), 9);
	h[2] = h[3] + ROL((h[2] + G(h[3], h[0], h[1]) + p[7] + T30), 14);
	h[1] = h[2] + ROL((h[1] + G(h[2], h[3], h[0]) + p[12] + T31), 20);
}

void		ft_md5_round3(uint32_t *h, uint32_t *p)
{
	h[0] = h[1] + ROL((h[0] + H(h[1], h[2], h[3]) + p[5] + T32), 4);
	h[3] = h[0] + ROL((h[3] + H(h[0], h[1], h[2]) + p[8] + T33), 11);
	h[2] = h[3] + ROL((h[2] + H(h[3], h[0], h[1]) + p[11] + T34), 16);
	h[1] = h[2] + ROL((h[1] + H(h[2], h[3], h[0]) + p[14] + T35), 23);
	h[0] = h[1] + ROL((h[0] + H(h[1], h[2], h[3]) + p[1] + T36), 4);
	h[3] = h[0] + ROL((h[3] + H(h[0], h[1], h[2]) + p[4] + T37), 11);
	h[2] = h[3] + ROL((h[2] + H(h[3], h[0], h[1]) + p[7] + T38), 16);
	h[1] = h[2] + ROL((h[1] + H(h[2], h[3], h[0]) + p[10] + T39), 23);
	h[0] = h[1] + ROL((h[0] + H(h[1], h[2], h[3]) + p[13] + T40), 4);
	h[3] = h[0] + ROL((h[3] + H(h[0], h[1], h[2]) + p[0] + T41), 11);
	h[2] = h[3] + ROL((h[2] + H(h[3], h[0], h[1]) + p[3] + T42), 16);
	h[1] = h[2] + ROL((h[1] + H(h[2], h[3], h[0]) + p[6] + T43), 23);
	h[0] = h[1] + ROL((h[0] + H(h[1], h[2], h[3]) + p[9] + T44), 4);
	h[3] = h[0] + ROL((h[3] + H(h[0], h[1], h[2]) + p[12] + T45), 11);
	h[2] = h[3] + ROL((h[2] + H(h[3], h[0], h[1]) + p[15] + T46), 16);
	h[1] = h[2] + ROL((h[1] + H(h[2], h[3], h[0]) + p[2] + T47), 23);
}

void		ft_md5_round4(uint32_t *h, uint32_t *p)
{
	h[0] = h[1] + ROL((h[0] + I(h[1], h[2], h[3]) + p[0] + T48), 6);
	h[3] = h[0] + ROL((h[3] + I(h[0], h[1], h[2]) + p[7] + T49), 10);
	h[2] = h[3] + ROL((h[2] + I(h[3], h[0], h[1]) + p[14] + T50), 15);
	h[1] = h[2] + ROL((h[1] + I(h[2], h[3], h[0]) + p[5] + T51), 21);
	h[0] = h[1] + ROL((h[0] + I(h[1], h[2], h[3]) + p[12] + T52), 6);
	h[3] = h[0] + ROL((h[3] + I(h[0], h[1], h[2]) + p[3] + T53), 10);
	h[2] = h[3] + ROL((h[2] + I(h[3], h[0], h[1]) + p[10] + T54), 15);
	h[1] = h[2] + ROL((h[1] + I(h[2], h[3], h[0]) + p[1] + T55), 21);
	h[0] = h[1] + ROL((h[0] + I(h[1], h[2], h[3]) + p[8] + T56), 6);
	h[3] = h[0] + ROL((h[3] + I(h[0], h[1], h[2]) + p[15] + T57), 10);
	h[2] = h[3] + ROL((h[2] + I(h[3], h[0], h[1]) + p[6] + T58), 15);
	h[1] = h[2] + ROL((h[1] + I(h[2], h[3], h[0]) + p[13] + T59), 21);
	h[0] = h[1] + ROL((h[0] + I(h[1], h[2], h[3]) + p[4] + T60), 6);
	h[3] = h[0] + ROL((h[3] + I(h[0], h[1], h[2]) + p[11] + T61), 10);
	h[2] = h[3] + ROL((h[2] + I(h[3], h[0], h[1]) + p[2] + T62), 15);
	h[1] = h[2] + ROL((h[1] + I(h[2], h[3], h[0]) + p[9] + T63), 21);
}

void		ft_md5_algor(uint32_t *hash, char *text, size_t len)
{
	size_t		counter;
	uint32_t	*pointer;
	uint32_t	buf[4];

	counter = len / 64;
	pointer = (uint32_t *)text;
	while (counter--)
	{
		buf[0] = hash[0];
		buf[1] = hash[1];
		buf[2] = hash[2];
		buf[3] = hash[3];
		ft_md5_round1(hash, pointer);
		ft_md5_round2(hash, pointer);
		ft_md5_round3(hash, pointer);
		ft_md5_round4(hash, pointer);
		hash[0] += buf[0];
		hash[1] += buf[1];
		hash[2] += buf[2];
		hash[3] += buf[3];
		pointer += 16;
	}
}
